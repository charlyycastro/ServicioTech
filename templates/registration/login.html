{% extends "orders/base.html" %}
{% load static %}

{% block title %}Iniciar sesión · ServicioTech{% endblock %}

{% block content %}
<div class="d-flex justify-content-center">
  <div class="card shadow-sm" style="max-width: 460px; width: 100%;">
    <div class="card-body p-4">
      <h1 class="h3 text-center mb-4">ServicioTech</h1>

      {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
          {% for err in form.non_field_errors %}{{ err }}{% endfor %}
        </div>
      {% endif %}

      <form id="login-form" method="post" action="{% url 'login' %}">
        {% csrf_token %}
        {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

        <div class="mb-3">
          <label class="form-label" for="id_username">Usuario</label>
          <input class="form-control"
                 id="id_username"
                 name="username"
                 type="text"
                 autocomplete="username"
                 required
                 autofocus>
        </div>

        <div class="mb-3">
  <label class="form-label" for="id_password">Contraseña</label>

  <!-- contenedor relativo SOLO del input -->
  <div class="position-relative">
    <input class="form-control pe-5"
           id="id_password"
           name="password"
           type="password"
           autocomplete="current-password"
           required>

    <!-- botón ojo dentro del input (overlay) -->
    <button type="button"
            id="togglePassword"
            class="input-eye-btn"
            aria-label="Mostrar u ocultar contraseña"
            aria-pressed="false">
      <!-- ojo abierto -->
      <svg id="eyeOpen" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
        <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8"/>
        <path d="M8 5.5a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5"/>
      </svg>
      <!-- ojo cerrado -->
      <svg id="eyeClosed" class="d-none" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
        <path d="M13.359 11.238C14.39 10.293 15.212 9.233 15.7 8c-.72-1.8-3.64-5.5-7.7-5.5-1.077 0-2.07.24-2.97.63l.77.77A6.24 6.24 0 0 1 8 3.5c3.5 0 6.167 3.5 6.167 3.5-.286.66-.86 1.47-1.635 2.234l-.173.167z"/>
        <path d="M3.354 4.146 1.5 2.293l-.708.707 2.2 2.2C1.714 6.41.934 7.47.45 8.7c.72 1.8 3.64 5.5 7.7 5.5 1.23 0 2.363-.3 3.37-.796l2.29 2.29.707-.707-12.46-12.54zm6.465 8.465A6.24 6.24 0 0 1 8 12.5C4.5 12.5 1.833 9 1.833 9c.286-.66.86-1.47 1.636-2.234l.173-.167 1.252 1.252a2.5 2.5 0 0 0 3.457 3.457l1.469 1.469z"/>
      </svg>
          </button>
        </div>

        <button class="btn btn-primary w-100" type="submit">Entrar</button>
      </form>

      <p class="text-center mt-3 mb-0">
        <a href="{% url 'password_reset' %}">¿Olvidaste tu contraseña?</a>
      </p>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    const pwd = document.getElementById('id_password');
    const btn = document.getElementById('togglePassword');
    const eyeOpen = document.getElementById('eyeOpen');
    const eyeClosed = document.getElementById('eyeClosed');

    if (!pwd || !btn) return;

    btn.addEventListener('click', function(e){
      e.preventDefault();
      const show = pwd.type === 'password';
      pwd.type = show ? 'text' : 'password';
      this.setAttribute('aria-pressed', show ? 'true' : 'false');
      eyeOpen.classList.toggle('d-none', !show);
      eyeClosed.classList.toggle('d-none', show);
      // Mantén el foco en el campo
      pwd.focus();
    });
    // Enter ya envía el formulario por defecto; no añadimos JS extra.
  })();
</script>
{% endblock %}
