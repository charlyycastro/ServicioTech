{% extends "orders/base.html" %}
{% load static %}

{% block title %}Iniciar sesión · ServicioTech{% endblock %}

{% block content %}
<div class="d-flex justify-content-center">
  <div class="card shadow-sm" style="max-width: 460px; width: 100%;">
    <div class="card-body p-4">
      <h1 class="h3 text-center mb-4">ServicioTech</h1>

      {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
          {% for err in form.non_field_errors %}{{ err }}{% endfor %}
        </div>
      {% endif %}

      <form id="login-form" method="post" action="{% url 'login' %}">
        {% csrf_token %}
        {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

        <div class="mb-3">
          <label class="form-label" for="id_username">Usuario</label>
          <input class="form-control" id="id_username" name="username" type="text"
                 autocomplete="username" required autofocus>
        </div>

        <div class="mb-1">
          <label class="form-label" for="id_password">Contraseña</label>
          <div class="position-relative">
            <input class="form-control pe-5" id="id_password" name="password" type="password"
                   autocomplete="current-password" required>

            <!-- Botón ojo (visibility_off / visibility) -->
            <button type="button" id="togglePassword" class="input-eye-btn"
                    aria-label="Mostrar u ocultar contraseña" aria-pressed="false">
              <!-- cerrado por defecto -->
              <svg id="eyeClosed" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                   fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 6C7 6 3.5 9.33 2 12c.6 1.08 1.52 2.39 2.82 3.58l-1.41 1.41C1.65 15.89.58 14.22 0 12 1.8 7.33 6.4 4 12 4c1.55 0 3.03.27 4.38.77l-1.57 1.57C13.87 6.12 12.97 6 12 6Zm10 6c-.36 1.35-1.08 2.7-2.18 3.9a14.43 14.43 0 0 1-1.9 1.72l-1.45-1.45c.82-.55 1.57-1.2 2.22-1.91C20.86 13.56 21.4 12.76 21.73 12 20.2 9.33 16.7 6 12 6c-.26 0-.52.01-.77.03L9.66 8.59c.76-.24 1.56-.36 2.34-.36a5.77 5.77 0 0 1 5.77 5.77c0 .78-.12 1.58-.36 2.34l2.13 2.13c1.17-.86 2.22-1.9 3.14-3.07.74-.94 1.28-1.84 1.64-2.4Z"/>
                <path d="M2.1 3.51 3.51 2.1l18.4 18.39-1.41 1.42-3.24-3.24A9.4 9.4 0 0 1 12 20c-5.6 0-10.2-3.33-12-8 .64-1.82 1.83-3.57 3.44-5.01L2.1 3.5Zm2.5 4.92C3.25 9.67 2.42 10.82 2 12c1.8 4.67 6.4 8 10 8 1.2 0 2.35-.22 3.41-.62l-1.67-1.67A5.77 5.77 0 0 1 6.5 10.1l-1.9-1.66Z"/>
              </svg>
              <svg id="eyeOpen" class="d-none" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                   fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 4c5.6 0 10.2 3.33 12 8-1.8 4.67-6.4 8-12 8S1.8 16.67 0 12c1.8-4.67 6.4-8 12-8Zm0 2C7 6 3.5 9.33 2 12c1.5 2.67 5 6 10 6s8.5-3.33 10-6c-1.5-2.67-5-6-10-6Zm0 2.5A3.5 3.5 0 1 1 8.5 12 3.5 3.5 0 0 1 12 8.5Zm0 2A1.5 1.5 0 1 0 13.5 12 1.5 1.5 0 0 0 12 10.5Z"/>
              </svg>
            </button>
          </div>
        </div>

        <button class="btn btn-primary w-100 mt-3" type="submit">Entrar</button>
      </form>

      <p class="text-center mt-3 mb-0">
        <a href="{% url 'password_reset' %}">¿Olvidaste tu contraseña?</a>
      </p>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    const pwd = document.getElementById('id_password');
    const btn = document.getElementById('togglePassword');
    const eyeOpen = document.getElementById('eyeOpen');
    const eyeClosed = document.getElementById('eyeClosed');
    if (!pwd || !btn) return;

    btn.addEventListener('click', function(e){
      e.preventDefault();
      const show = pwd.type === 'password';
      pwd.type = show ? 'text' : 'password';
      this.setAttribute('aria-pressed', show ? 'true' : 'false');
      eyeOpen.classList.toggle('d-none', !show);
      eyeClosed.classList.toggle('d-none', show);
      pwd.focus();
    });
  })();
</script>
{% endblock %}
